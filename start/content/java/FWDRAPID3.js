/* ID3 reader, minified, nothing to modify here! */
(function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof _s?this:_s:global:window,t.jsmediatags=e()}})(function(){return function d(g,e,t){function a(i,o){if(!e[i]){if(!g[i]){var n="function"==typeof require&&require;if(!o&&n)return n(i,!0);if(r)return r(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var u=e[i]={exports:{}};g[i][0].call(u.exports,function(t){var e=g[i][1][t];return a(e?e:t)},u,u.exports,d,g,e,t)}return e[i].exports}for(var r="function"==typeof require&&require,n=0;n<t.length;n++)a(t[n]);return a}({1:[function(){},{}],2:[function(e,t){t.exports=XMLHttpRequest},{}],3:[function(e,t){'use strict';function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:l(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=e("./MediaFileReader"),f=function(e){function t(e){var a;return r(this,t),a=i(this,s(t).call(this)),g(l(a),"_array",void 0),g(l(a),"_size",void 0),a._array=e,a._size=e.length,a._isInitialized=!0,a}return d(t,e),n(t,[{key:"init",value:function(e){setTimeout(e.onSuccess,0)}},{key:"loadRange",value:function(e,t){setTimeout(t.onSuccess,0)}},{key:"getByteAt",value:function(e){if(e>=this._array.length)throw new Error("Offset "+e+" hasn't been loaded yet.");return this._array[e]}}],[{key:"canReadFile",value:function(e){return Array.isArray(e)||"function"==typeof Buffer&&Buffer.isBuffer(e)}}]),t}(c);t.exports=f},{"./MediaFileReader":11}],4:[function(e,t){'use strict';function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:l(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=e("./ChunkedFileData"),f=e("./MediaFileReader"),y=function(e){function t(e){var a;return r(this,t),a=i(this,s(t).call(this)),g(l(a),"_blob",void 0),g(l(a),"_fileData",void 0),a._blob=e,a._fileData=new c,a}return d(t,e),n(t,[{key:"_init",value:function(e){this._size=this._blob.size,setTimeout(e.onSuccess,1)}},{key:"loadRange",value:function(e,t){var a=this,r=this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice,o=r.call(this._blob,e[0],e[1]+1),n=new FileReader;n.onloadend=function(){var r=new Uint8Array(n.result);a._fileData.addData(e[0],r),t.onSuccess()},n.onerror=n.onabort=function(){t.onError&&t.onError({type:"blob",info:n.error})},n.readAsArrayBuffer(o)}},{key:"getByteAt",value:function(e){return this._fileData.getByteAt(e)}}],[{key:"canReadFile",value:function(e){return"undefined"!=typeof Blob&&e instanceof Blob||"undefined"!=typeof File&&e instanceof File}}]),t}(f);t.exports=y},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(e,t){'use strict';function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var i=function(){function e(){a(this,e),n(this,"_fileData",void 0),this._fileData=[]}return o(e,null,[{key:"NOT_FOUND",get:function(){return-1}}]),o(e,[{key:"addData",value:function(e,t){var a=e+t.length-1,r=this._getChunkRange(e,a);if(-1===r.startIx)this._fileData.splice(r.insertIx||0,0,{offset:e,_d:t});else{var o=this._fileData[r.startIx],n=this._fileData[r.endIx],i=e>o.offset,s=a<n.offset+n._d.length-1,l={offset:Math.min(e,o.offset),_d:t};if(i){var d=this._sliceData(o._d,0,e-o.offset);l._d=this._concatData(d,t)}if(s){var d=this._sliceData(l._d,0,n.offset-l.offset);l._d=this._concatData(d,n._d)}this._fileData.splice(r.startIx,r.endIx-r.startIx+1,l)}}},{key:"_concatData",value:function(e,t){if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){var a=new e.constructor(e.length+t.length);return a.set(e,0),a.set(t,e.length),a}return e.concat(t)}},{key:"_sliceData",value:function(e,t,a){return e.slice?e.slice(t,a):e.subarray(t,a)}},{key:"_getChunkRange",value:function(e,t){for(var a=-1,r=-1,o=0,n=0;n<this._fileData.length;n++,o=n){var s=this._fileData[n].offset,l=s+this._fileData[n]._d.length;if(t<s-1)break;if(e<=l+1&&t>=s-1){a=n;break}}if(-1===a)return{startIx:-1,endIx:-1,insertIx:o};for(var n=a;n<this._fileData.length;n++){var s=this._fileData[n].offset,l=s+this._fileData[n]._d.length;if(t>=s-1&&(r=n),t<=l+1)break}return-1===r&&(r=a),{startIx:a,endIx:r}}},{key:"hasDataRange",value:function(e,t){for(var a,r=0;r<this._fileData.length;r++){if(a=this._fileData[r],t<a.offset)return!1;if(e>=a.offset&&t<a.offset+a._d.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var t,a=0;a<this._fileData.length;a++){var r=this._fileData[a].offset,o=r+this._fileData[a]._d.length-1;if(e>=r&&e<=o){t=this._fileData[a];break}}if(t)return t._d[e-t.offset];throw new Error("Offset "+e+" hasn't been loaded yet.")}}]),e}();t.exports=i},{}],6:[function(e,t){"use strict";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:l(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=e("./MediaTagReader"),f=[4,132],y=[6,134],p=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"],m=function(e){function t(){var e,a;r(this,t);for(var o=arguments.length,n=Array(o),d=0;d<o;d++)n[d]=arguments[d];return a=i(this,(e=s(t)).call.apply(e,[this].concat(n))),g(l(a),"_commentOffset",void 0),g(l(a),"_pictureOffset",void 0),a}return d(t,e),n(t,[{key:"_loadData",value:function(e,t){var a=this;e.loadRange([4,7],{onSuccess:function(){a._loadBlock(e,4,t)}})}},{key:"_loadBlock",value:function(e,t,a){var r=this,o=e.getByteAt(t),n=e.getInteger24At(t+1,!0);if(-1!==f.indexOf(o)){var i=t+4;e.loadRange([i,i+n],{onSuccess:function(){r._commentOffset=i,r._nextBlock(e,t,o,n,a)}})}else if(-1!==y.indexOf(o)){var i=t+4;e.loadRange([i,i+n],{onSuccess:function(){r._pictureOffset=i,r._nextBlock(e,t,o,n,a)}})}else r._nextBlock(e,t,o,n,a)}},{key:"_nextBlock",value:function(e,t,a,r,o){var n=this;127<a?n._commentOffset?o.onSuccess():o.onError({type:"loadData",info:"Comment block could not be found."}):e.loadRange([t+4+r,t+4+4+r],{onSuccess:function(){n._loadBlock(e,t+4+r,o)}})}},{key:"_parseData",value:function(e){for(var t,a,r,o,n,l,u=e.getLongAt(this._commentOffset,!1),g=this._commentOffset+4,c=u+g,f=e.getLongAt(c,!1),y=c+4,m=0;m<f;m++){var _=e.getLongAt(y,!1),h=e.getStringWithCharsetAt(y+4,_,"utf-8").toString(),s=h.indexOf("="),d=[h.slice(0,s),h.slice(s+1)];switch(d[0]){case"TITLE":t=d[1];break;case"ARTIST":a=d[1];break;case"ALBUM":r=d[1];break;case"TRACKNUMBER":o=d[1];break;case"GENRE":n=d[1];}y+=4+_}if(this._pictureOffset){var R=e.getLongAt(this._pictureOffset,!0),T=this._pictureOffset+4,S=e.getLongAt(T,!0),b=T+4,A=e.getStringAt(b,S),C=b+S,k=e.getLongAt(C,!0),v=C+4,P=e.getStringWithCharsetAt(v,k,"utf-8").toString(),O=v+k+16,D=e.getLongAt(O,!0),B=e.getBytesAt(O+4,D,!0);l={format:A,type:p[R],description:P,_d:B}}var F={type:"FLAC",version:"1",tags:{title:t,artist:a,album:r,track:o,genre:n,picture:l}};return F}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:4}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(0,4));return"fLaC"===t}}]),t}(c);t.exports=m},{"./MediaTagReader":12}],7:[function(e,t){'use strict';function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:s(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}var g=e("./MediaTagReader"),c=e("./MediaFileReader"),f=function(e){function t(){return r(this,t),i(this,l(t).apply(this,arguments))}return d(t,e),n(t,[{key:"_loadData",value:function(e,t){var a=e.getSize();e.loadRange([a-128,a-1],t)}},{key:"_parseData",value:function(e){var t=e.getSize()-128,a=e.getStringWithCharsetAt(t+3,30).toString(),r=e.getStringWithCharsetAt(t+33,30).toString(),o=e.getStringWithCharsetAt(t+63,30).toString(),n=e.getStringWithCharsetAt(t+93,4).toString(),i=e.getByteAt(t+97+28),s=e.getByteAt(t+97+29);if(0==i&&0!=s)var l="1.1",d=e.getStringWithCharsetAt(t+97,28).toString();else{var l="1.0",d=e.getStringWithCharsetAt(t+97,30).toString();s=0}var u=e.getByteAt(t+97+30);if(255>u)var g=y[u];else var g="";var c={type:"ID3",version:l,tags:{title:a,artist:r,album:o,year:n,comment:d,genre:g}};return s&&(c.tags.track=s),c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(0,3));return"TAG"===t}}]),t}(g),y=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"];t.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(e,t){'use strict';function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}function n(e){var t;return t=0===e?"iso-8859-1":1===e?"utf-16":2===e?"utf-16be":3===e?"utf-8":"iso-8859-1",t}function i(e,t,a,r){var o=a.getStringWithCharsetAt(e+1,t-1,r),n=a.getStringWithCharsetAt(e+1+o.bytesReadCount,t-1-o.bytesReadCount,r);return{user_description:o.toString(),_d:n.toString()}}var s=e("./MediaFileReader"),l=e("./StringUtils"),d=e("./ArrayFileReader"),u={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},g=function(){function e(){a(this,e)}return o(e,null,[{key:"getFrameReaderFunction",value:function(e){return e in c?c[e]:"T"===e[0]?c["T*"]:"W"===e[0]?c["W*"]:null}},{key:"readFrames",value:function(t,a,r,o,n){for(var i={},s=this._getFrameHeaderSize(o);t<a-s;){var l=this._readFrameHeader(r,t,o),d=l.id;if(!d)break;var u=l.flags,g=l.size,c=t+l.headerSize,f=r;if(t+=l.headerSize+l.size,!(n&&-1===n.indexOf(d))){if("MP3e"===d||"\0MP3"===d||"\0\0MP"===d||" MP3"===d)break;u&&u.format.unsynchronisation&&(f=this.getUnsyncFileReader(f,c,g),c=0,g=f.getSize()),u&&u.format.data_length_indicator&&(c+=4,g-=4);var y=e.getFrameReaderFunction(d),p=y?y.apply(this,[c,g,f,u,o]):null,m=this._getFrameDescription(d),_={id:d,size:g,description:m,_d:p};d in i?(i[d].id&&(i[d]=[i[d]]),i[d].push(_)):i[d]=_}}return i}},{key:"_getFrameHeaderSize",value:function(e){var t=e.major;return 2==t?6:3==t||4==t?10:0}},{key:"_readFrameHeader",value:function(e,t,a){var r=a.major,o=null,n=this._getFrameHeaderSize(a);switch(r){case 2:var i=e.getStringAt(t,3),s=e.getInteger24At(t+3,!0);break;case 3:var i=e.getStringAt(t,4),s=e.getLongAt(t+4,!0);break;case 4:var i=e.getStringAt(t,4),s=e.getSynchsafeInteger32At(t+4);}return(i==String.fromCharCode(0,0,0)||i==String.fromCharCode(0,0,0,0))&&(i=""),i&&2<r&&(o=this._readFrameFlags(e,t+8)),{id:i||"",size:s||0,headerSize:n||0,flags:o}}},{key:"_readFrameFlags",value:function(e,t){return{message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encryption:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}}}},{key:"_getFrameDescription",value:function(e){return e in u?u[e]:"Unknown"}},{key:"getUnsyncFileReader",value:function(e,t,a){for(var r=e.getBytesAt(t,a),o=0;o<r.length-1;o++)255===r[o]&&0===r[o+1]&&r.splice(o+1,1);return new d(r)}}]),e}();var c={};c.APIC=function(e,t,a,r,o){var i=e,s=n(a.getByteAt(e));switch(o&&o.major){case 2:var l=a.getStringAt(e+1,3);e+=4;break;case 3:case 4:var l=a.getStringWithCharsetAt(e+1,t-1);e+=1+l.bytesReadCount;break;default:throw new Error("Couldn't read ID3v2 major version.");}var d=a.getByteAt(e),u=f[d],g=a.getStringWithCharsetAt(e+1,t-(e-i)-1,s);return e+=1+g.bytesReadCount,{format:l.toString(),type:u,description:g.toString(),_d:a.getBytesAt(e,i+t-e)}},c.CHAP=function(e,t,a,r,o){var n=e,i={},s=l.readNullTerminatedString(a.getBytesAt(e,t));i.id=s.toString(),e+=s.bytesReadCount,i.startTime=a.getLongAt(e,!0),e+=4,i.endTime=a.getLongAt(e,!0),e+=4,i.startOffset=a.getLongAt(e,!0),e+=4,i.endOffset=a.getLongAt(e,!0),e+=4;var d=t-(e-n);return i.subFrames=this.readFrames(e,e+d,a,o),i},c.CTOC=function(e,t,a,r,o){var n=e,s={childElementIds:[],id:void 0,topLevel:void 0,ordered:void 0,entryCount:void 0,subFrames:void 0},d=l.readNullTerminatedString(a.getBytesAt(e,t));s.id=d.toString(),e+=d.bytesReadCount,s.topLevel=a.isBitSetAt(e,1),s.ordered=a.isBitSetAt(e,0),e++,s.entryCount=a.getByteAt(e),e++;for(var u,g=0;g<s.entryCount;g++)u=l.readNullTerminatedString(a.getBytesAt(e,t-(e-n))),s.childElementIds.push(u.toString()),e+=u.bytesReadCount;var c=t-(e-n);return s.subFrames=this.readFrames(e,e+c,a,o),s},c.COMM=function(e,t,a){var r=e,o=n(a.getByteAt(e)),i=a.getStringAt(e+1,3),s=a.getStringWithCharsetAt(e+4,t-4,o);e+=4+s.bytesReadCount;var l=a.getStringWithCharsetAt(e,r+t-e,o);return{language:i,short_description:s.toString(),text:l.toString()}},c.COM=c.COMM,c.PIC=function(e,t,a,r,o){return c.APIC(e,t,a,r,o)},c.PCNT=function(e,t,a){return a.getLongAt(e,!1)},c.CNT=c.PCNT,c["T*"]=function(e,t,a){var r=n(a.getByteAt(e));return a.getStringWithCharsetAt(e+1,t-1,r).toString()},c.TXXX=function(e,t,a){var r=n(a.getByteAt(e));return i(e,t,a,r)},c.WXXX=function(e,t,a){if(0===t)return null;var r=n(a.getByteAt(e));return i(e,t,a,r)},c["W*"]=function(e,t,a){return 0===t?null:a.getStringWithCharsetAt(e,t,"iso-8859-1").toString()},c.TCON=function(){var e=c["T*"].apply(this,arguments);return e.replace(/^\(\d+\)/,"")},c.TCO=c.TCON,c.USLT=function(e,t,a){var r=e,o=n(a.getByteAt(e)),i=a.getStringAt(e+1,3),s=a.getStringWithCharsetAt(e+4,t-4,o);e+=4+s.bytesReadCount;var l=a.getStringWithCharsetAt(e,r+t-e,o);return{language:i,descriptor:s.toString(),lyrics:l.toString()}},c.ULT=c.USLT,c.UFID=function(e,t,a){var r=l.readNullTerminatedString(a.getBytesAt(e,t));e+=r.bytesReadCount;var o=a.getBytesAt(e,t-r.bytesReadCount);return{ownerIdentifier:r.toString(),identifier:o}};var f=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];t.exports=g},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(e,t){'use strict';function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:s(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}var g=e("./MediaTagReader"),c=e("./MediaFileReader"),f=e("./ID3v2FrameReader"),y=10,p=function(e){function t(){return r(this,t),i(this,l(t).apply(this,arguments))}return d(t,e),n(t,[{key:"_loadData",value:function(e,t){e.loadRange([6,9],{onSuccess:function(){e.loadRange([0,y+e.getSynchsafeInteger32At(6)-1],t)},onError:t.onError})}},{key:"_parseData",value:function(e,t){var a=0,r=e.getByteAt(a+3);if(4<r)return{type:"ID3",version:">2.4",tags:{}};var o=e.getByteAt(a+4),n=e.isBitSetAt(a+5,7),i=e.isBitSetAt(a+5,6),s=e.isBitSetAt(a+5,5),l=e.getSynchsafeInteger32At(a+6);if(a+=10,i)if(4===r){var d=e.getSynchsafeInteger32At(a);a+=d}else{var d=e.getLongAt(a,!0);a+=d+4}var u={type:"ID3",version:"2."+r+"."+o,major:r,revision:o,flags:{unsynchronisation:n,extended_header:i,experimental_indicator:s,footer_present:!1},size:l,tags:{}};if(t)var g=this._expandShortcutTags(t);var c=l+10;u.flags.unsynchronisation&&(e=f.getUnsyncFileReader(e,a,l),a=0,c=e.getSize());var y=f.readFrames(a,c,e,u,g);for(var p in m)if(m.hasOwnProperty(p)){var _=this._getFrameData(y,m[p]);_&&(u.tags[p]=_)}for(var h in y)y.hasOwnProperty(h)&&(u.tags[h]=y[h]);return u}},{key:"_getFrameData",value:function(e,t){for(var a,r,o=0;r=t[o];o++)if(r in e)return a=e[r]instanceof Array?e[r][0]:e[r],a._d}},{key:"getShortcuts",value:function(){return m}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:y}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(0,3));return"ID3"===t}}]),t}(g),m={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};t.exports=p},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(e,t){'use strict';function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:s(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}var g=e("./MediaTagReader"),c=e("./MediaFileReader"),f=function(e){function t(){return r(this,t),i(this,l(t).apply(this,arguments))}return d(t,e),n(t,[{key:"_loadData",value:function(e,t){var a=this;e.loadRange([0,16],{onSuccess:function(){a._loadAtom(e,0,"",t)},onError:t.onError})}},{key:"_loadAtom",value:function(e,t,a,r){if(t>=e.getSize())return void r.onSuccess();var o=this,n=e.getLongAt(t,!0);if(0==n||isNaN(n))return void r.onSuccess();var i=e.getStringAt(t+4,4);if(this._isContainerAtom(i)){"meta"==i&&(t+=4);var s=(a?a+".":"")+i;"moov.udta.meta.ilst"==s?e.loadRange([t,t+n],r):e.loadRange([t+8,t+8+8],{onSuccess:function(){o._loadAtom(e,t+8,s,r)},onError:r.onError})}else e.loadRange([t+n,t+n+8],{onSuccess:function(){o._loadAtom(e,t+n,a,r)},onError:r.onError})}},{key:"_isContainerAtom",value:function(e){return 0<=["moov","udta","meta","ilst"].indexOf(e)}},{key:"_canReadAtom",value:function(e){return"----"!==e}},{key:"_parseData",value:function(e,t){var a={};for(var r in t=this._expandShortcutTags(t),this._readAtom(a,e,0,e.getSize(),t),m)if(m.hasOwnProperty(r)){var o=a[m[r]];o&&("track"===r?a[r]=o._d.track:a[r]=o._d)}return{type:"MP4",ftyp:e.getStringAt(8,4),version:e.getLongAt(12,!0),tags:a}}},{key:"_readAtom",value:function(e,t,a,r,o,n,i){i=void 0===i?"":i+"  ";for(var s,l=a;l<a+r;){if(s=t.getLongAt(l,!0),0==s)return;var d=t.getStringAt(l+4,4);if(this._isContainerAtom(d)){"meta"==d&&(l+=4);var u=(n?n+".":"")+d;return void this._readAtom(e,t,l+8,s-8,o,u,i)}(!o||0<=o.indexOf(d))&&"moov.udta.meta.ilst"===n&&this._canReadAtom(d)&&(e[d]=this._readMetadataAtom(t,l)),l+=s}}},{key:"_readMetadataAtom",value:function(e,t){var a,r=e.getLongAt(t,!0),o=e.getStringAt(t+4,4),n=e.getInteger24At(t+16+1,!0),i=y[n];if("trkn"==o)a={track:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else if("disk"==o)a={disk:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else{var a,s=t+24,l=r-24;switch("covr"===o&&"uint8"===i&&(i="jpeg"),i){case"text":a=e.getStringWithCharsetAt(s,l,"utf-8").toString();break;case"uint8":a=e.getShortAt(s,!1);break;case"int":case"uint":var d="int"==i?1==l?e.getSByteAt:2==l?e.getSShortAt:4==l?e.getSLongAt:e.getLongAt:1==l?e.getByteAt:2==l?e.getShortAt:e.getLongAt;a=d.call(e,s+(8==l?4:0),!0);break;case"jpeg":case"png":a={format:"image/"+i,_d:e.getBytesAt(s,l)};}}return{id:o,size:r,description:p[o]||"Unknown",_d:a}}},{key:"getShortcuts",value:function(){return m}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(e){var t=String.fromCharCode.apply(String,e.slice(4,8));return"ftyp"===t}}]),t}(g),y={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"},p={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"},m={title:"\xA9nam",artist:"\xA9ART",album:"\xA9alb",year:"\xA9day",comment:"\xA9cmt",track:"trkn",genre:"\xA9gen",picture:"covr",lyrics:"\xA9lyr"};t.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(e,t){'use strict';function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var i=e("./StringUtils"),s=function(){function e(){a(this,e),n(this,"_isInitialized",void 0),n(this,"_size",void 0),this._isInitialized=!1,this._size=0}return o(e,[{key:"init",value:function(e){var t=this;return this._isInitialized?void setTimeout(e.onSuccess,1):this._init({onSuccess:function(){t._isInitialized=!0,e.onSuccess()},onError:e.onError})}},{key:"_init",value:function(){throw new Error("Must implement init function")}},{key:"loadRange",value:function(){throw new Error("Must implement loadRange function")}},{key:"getSize",value:function(){if(!this._isInitialized)throw new Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(){throw new Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function(e,t){for(var a=Array(t),r=0;r<t;r++)a[r]=this.getByteAt(e+r);return a}},{key:"isBitSetAt",value:function(e,t){var a=this.getByteAt(e);return 0!=(a&1<<t)}},{key:"getSByteAt",value:function(e){var t=this.getByteAt(e);return 127<t?t-256:t}},{key:"getShortAt",value:function(e,t){var a=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return 0>a&&(a+=65536),a}},{key:"getSShortAt",value:function(e,t){var a=this.getShortAt(e,t);return 32767<a?a-65536:a}},{key:"getLongAt",value:function(e,t){var a=this.getByteAt(e),r=this.getByteAt(e+1),o=this.getByteAt(e+2),n=this.getByteAt(e+3),i=t?(((a<<8)+r<<8)+o<<8)+n:(((n<<8)+o<<8)+r<<8)+a;return 0>i&&(i+=4294967296),i}},{key:"getSLongAt",value:function(e,t){var a=this.getLongAt(e,t);return 2147483647<a?a-4294967296:a}},{key:"getInteger24At",value:function(e,t){var a=this.getByteAt(e),r=this.getByteAt(e+1),o=this.getByteAt(e+2),n=t?((a<<8)+r<<8)+o:((o<<8)+r<<8)+a;return 0>n&&(n+=16777216),n}},{key:"getStringAt",value:function(e,t){for(var a=[],r=e,o=0;r<e+t;r++,o++)a[o]=String.fromCharCode(this.getByteAt(r));return a.join("")}},{key:"getStringWithCharsetAt",value:function(e,t,a){var r,o=this.getBytesAt(e,t);switch((a||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":r=i.readUTF16String(o,"utf-16be"===a);break;case"utf-8":r=i.readUTF8String(o);break;default:r=i.readNullTerminatedString(o);}return r}},{key:"getCharAt",value:function(e){return String.fromCharCode(this.getByteAt(e))}},{key:"getSynchsafeInteger32At",value:function(e){var t=this.getByteAt(e),a=this.getByteAt(e+1),r=this.getByteAt(e+2),o=this.getByteAt(e+3);return 127&o|(127&r)<<7|(127&a)<<14|(127&t)<<21}}],[{key:"canReadFile",value:function(){throw new Error("Must implement canReadFile function")}}]),e}();t.exports=s},{"./StringUtils":13}],12:[function(e,t){'use strict';function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var i=e("./MediaFileReader"),s=function(){function e(t){a(this,e),n(this,"_mediaFileReader",void 0),n(this,"_tags",void 0),this._mediaFileReader=t,this._tags=null}return o(e,[{key:"setTagsToRead",value:function(e){return this._tags=e,this}},{key:"read",value:function(e){var t=this;this._mediaFileReader.init({onSuccess:function(){t._loadData(t._mediaFileReader,{onSuccess:function(){try{var a=t._parseData(t._mediaFileReader,t._tags)}catch(t){if(e.onError)return void e.onError({type:"parseData",info:t.message})}e.onSuccess(a)},onError:e.onError})},onError:e.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(){throw new Error("Must implement _loadData function")}},{key:"_parseData",value:function(){throw new Error("Must implement _parseData function")}},{key:"_expandShortcutTags",value:function(e){if(!e)return null;for(var t,a=[],r=this.getShortcuts(),o=0;t=e[o];o++)a=a.concat(r[t]||[t]);return a}}],[{key:"getTagIdentifierByteRange",value:function(){throw new Error("Must implement")}},{key:"canReadTagFormat",value:function(){throw new Error("Must implement")}}]),e}();t.exports=s},{"./MediaFileReader":11}],13:[function(e,t){'use strict';function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var s=function(){function e(t,r){a(this,e),n(this,"_value",void 0),n(this,"bytesReadCount",void 0),n(this,"length",void 0),this._value=t,this.bytesReadCount=r,this.length=t.length}return o(e,[{key:"toString",value:function(){return this._value}}]),e}();t.exports={readUTF16String:function(e,t,a){var r=0,o=1,n=0;a=Math.min(a||e.length,e.length),254==e[0]&&255==e[1]?(t=!0,r=2):255==e[0]&&254==e[1]&&(t=!1,r=2),t&&(o=0,n=1);for(var i=[],l=0;r<a;l++){var d=e[r+o],u=e[r+n],g=(d<<8)+u;if(r+=2,0==g)break;else if(216>d||224<=d)i[l]=String.fromCharCode(g);else{var c=e[r+o],f=e[r+n];r+=2,i[l]=String.fromCharCode(g,(c<<8)+f)}}return new s(i.join(""),r)},readUTF8String:function(e,t){var a=0;t=Math.min(t||e.length,e.length),239==e[0]&&187==e[1]&&191==e[2]&&(a=3);for(var r,o=[],n=0;a<t&&(r=e[a++],0!=r);n++)if(128>r)o[n]=String.fromCharCode(r);else if(194<=r&&224>r){var i=e[a++];o[n]=String.fromCharCode(((31&r)<<6)+(63&i))}else if(224<=r&&240>r){var i=e[a++],l=e[a++];o[n]=String.fromCharCode(((255&r)<<12)+((63&i)<<6)+(63&l))}else if(240<=r&&245>r){var i=e[a++],l=e[a++],d=e[a++],u=((7&r)<<18)+((63&i)<<12)+((63&l)<<6)+(63&d)-65536;o[n]=String.fromCharCode((u>>10)+55296,(1023&u)+56320)}return new s(o.join(""),a)},readNullTerminatedString:function(e,t){var a=[];t=t||e.length;for(var r,o=0;o<t&&(r=e[o++],0!=r);)a[o-1]=String.fromCharCode(r);return new s(a.join(""),o)}}},{}],14:[function(e,t){'use strict';function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function n(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}function i(e,t){return t&&("object"===a(t)||"function"==typeof t)?t:l(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=e("./ChunkedFileData"),f=e("./MediaFileReader"),y=1024,p=function(t){function a(e){var t;return r(this,a),t=i(this,s(a).call(this)),g(l(t),"_url",void 0),g(l(t),"_fileData",void 0),t._url=e,t._fileData=new c,t}return d(a,t),n(a,[{key:"_init",value:function(e){a._config.avoidHeadRequests?this._fetchSizeWithGetRequest(e):this._fetchSizeWithHeadRequest(e)}},{key:"_fetchSizeWithHeadRequest",value:function(e){var t=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(a){var r=t._parseContentLength(a);r?(t._size=r,e.onSuccess()):t._fetchSizeWithGetRequest(e)},onError:e.onError})}},{key:"_fetchSizeWithGetRequest",value:function(e){var t=this,a=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",a,{onSuccess:function(a){var r=t._parseContentRange(a),o=t._getXhrResponseContent(a);if(r){if(null==r.instanceLength)return void t._fetchEntireFile(e);t._size=r.instanceLength}else t._size=o.length;t._fileData.addData(0,o),e.onSuccess()},onError:e.onError})}},{key:"_fetchEntireFile",value:function(e){var t=this;this._makeXHRRequest("GET",null,{onSuccess:function(a){var r=t._getXhrResponseContent(a);t._size=r.length,t._fileData.addData(0,r),e.onSuccess()},onError:e.onError})}},{key:"_getXhrResponseContent",value:function(e){return e.responseBody||e.responseText||""}},{key:"_parseContentLength",value:function(e){var t=this._getResponseHeader(e,"Content-Length");return null==t?t:parseInt(t,10)}},{key:"_parseContentRange",value:function(e){var t=this._getResponseHeader(e,"Content-Range");if(t){var a=t.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!a)throw new Error("FIXME: Unknown Content-Range syntax: "+t);return{firstBytePosition:parseInt(a[1],10),lastBytePosition:parseInt(a[2],10),instanceLength:a[3]?parseInt(a[3],10):null}}return null}},{key:"loadRange",value:function(e,t){var a=this;return a._fileData.hasDataRange(e[0],Math.min(a._size,e[1]))?void setTimeout(t.onSuccess,1):void(e=this._roundRangeToChunkMultiple(e),e[1]=Math.min(a._size,e[1]),this._makeXHRRequest("GET",e,{onSuccess:function(r){var o=a._getXhrResponseContent(r);a._fileData.addData(e[0],o),t.onSuccess()},onError:t.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(e){var t=e[1]-e[0]+1,a=Math.ceil(t/y)*y;return[e[0],e[0]+a-1]}},{key:"_makeXHRRequest",value:function(e,t,r){var o=this._createXHRObject();o.open(e,this._url);var n=function(){200===o.status||206===o.status?r.onSuccess(o):r.onError&&r.onError({type:"xhr",info:"Unexpected HTTP status "+o.status+".",xhr:o}),o=null};"undefined"==typeof o.onload?o.onreadystatechange=function(){4===o.readyState&&n()}:(o.onload=n,o.onerror=function(){r.onError&&r.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:o})}),a._config.timeoutInSec&&(o.timeout=1e3*a._config.timeoutInSec,o.ontimeout=function(){r.onError&&r.onError({type:"xhr",info:"Timeout after "+o.timeout/1e3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:o})}),o.overrideMimeType("text/plain; charset=x-user-defined"),t&&this._setRequestHeader(o,"Range","bytes="+t[0]+"-"+t[1]),this._setRequestHeader(o,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),o.send(null)}},{key:"_setRequestHeader",value:function(e,t,r){0>a._config.disallowedXhrHeaders.indexOf(t.toLowerCase())&&e.setRequestHeader(t,r)}},{key:"_hasResponseHeader",value:function(e,t){var a=e.getAllResponseHeaders();if(!a)return!1;for(var r=a.split("\r\n"),o=[],n=0;n<r.length;n++)o[n]=r[n].split(":")[0].toLowerCase();return 0<=o.indexOf(t.toLowerCase())}},{key:"_getResponseHeader",value:function(e,t){return this._hasResponseHeader(e,t)?e.getResponseHeader(t):null}},{key:"getByteAt",value:function(e){var t=this._fileData.getByteAt(e);return 255&t.charCodeAt(0)}},{key:"_isWebWorker",value:function(){return"undefined"!=typeof WorkerGlobalScope&&_s instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function(){if("undefined"==typeof window&&!this._isWebWorker())return new(e("xhr2").XMLHttpRequest);if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;throw new Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function(e){return"string"==typeof e&&/^[a-z]+:\/\//i.test(e)}},{key:"setConfig",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this._config[t]=e[t]);for(var a=this._config.disallowedXhrHeaders,r=0;r<a.length;r++)a[r]=a[r].toLowerCase()}}]),a}(f);g(p,"_config",void 0),p._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],timeoutInSec:30},t.exports=p},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(e,t){'use strict';function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}function o(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=0<=e.offset&&e.offset+e.length>=t,r=0>e.offset&&(-e.offset>t||0<e.offset+e.length);return!(a||r)}var l=e("./MediaFileReader"),d=e("./XhrFileReader"),u=e("./BlobFileReader"),g=e("./ArrayFileReader"),c=e("./MediaTagReader"),f=e("./ID3v1TagReader"),y=e("./ID3v2TagReader"),p=e("./MP4TagReader"),m=e("./FLACTagReader"),_=[],h=[],R=function(){function e(t){a(this,e),n(this,"_file",void 0),n(this,"_tagsToRead",void 0),n(this,"_fileReader",void 0),n(this,"_tagReader",void 0),this._file=t}return o(e,[{key:"setTagsToRead",value:function(e){return this._tagsToRead=e,this}},{key:"setFileReader",value:function(e){return this._fileReader=e,this}},{key:"setTagReader",value:function(e){return this._tagReader=e,this}},{key:"read",value:function(e){var t=this._getFileReader(),a=new t(this._file),r=this;a.init({onSuccess:function(){r._getTagReader(a,{onSuccess:function(t){new t(a).setTagsToRead(r._tagsToRead).read(e)},onError:e.onError})},onError:e.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var e=0;e<_.length;e++)if(_[e].canReadFile(this._file))return _[e];throw new Error("No suitable file reader found for "+this._file)}},{key:"_getTagReader",value:function(e,t){if(this._tagReader){var a=this._tagReader;setTimeout(function(){t.onSuccess(a)},1)}else this._findTagReader(e,t)}},{key:"_findTagReader",value:function(e,t){for(var a,r=[],o=[],n=e.getSize(),l=0;l<h.length;l++)(a=h[l].getTagIdentifierByteRange(),!!s(a,n))&&(0<=a.offset&&a.offset<n/2||0>a.offset&&a.offset<-n/2?r.push(h[l]):o.push(h[l]));var d=!1,u={onSuccess:function(){if(!d)return void(d=!0);for(var a,r=0;r<h.length;r++)if(a=h[r].getTagIdentifierByteRange(),!!s(a,n)){try{var o=e.getBytesAt(0<=a.offset?a.offset:a.offset+n,a.length)}catch(e){return void(t.onError&&t.onError({type:"fileReader",info:e.message}))}if(h[r].canReadTagFormat(o))return void t.onSuccess(h[r])}t.onError&&t.onError({type:"tagFormat",info:"No suitable tag reader found"})},onError:t.onError};this._loadTagIdentifierRanges(e,r,u),this._loadTagIdentifierRanges(e,o,u)}},{key:"_loadTagIdentifierRanges",value:function(e,t,a){if(0===t.length)return void setTimeout(a.onSuccess,1);for(var r=[Number.MAX_VALUE,0],o=e.getSize(),n=0;n<t.length;n++){var s=t[n].getTagIdentifierByteRange(),l=0<=s.offset?s.offset:s.offset+o,d=l+s.length-1;r[0]=Math.min(l,r[0]),r[1]=Math.max(d,r[1])}e.loadRange(r,a)}}]),e}(),T=function(){function e(){a(this,e)}return o(e,null,[{key:"addFileReader",value:function(t){return _.push(t),e}},{key:"addTagReader",value:function(t){return h.push(t),e}},{key:"removeTagReader",value:function(t){var a=h.indexOf(t);return 0<=a&&h.splice(a,1),e}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){d.setConfig({avoidHeadRequests:!0})}},{key:"setDisallowedXhrHeaders",value:function(e){d.setConfig({disallowedXhrHeaders:e})}},{key:"setXhrTimeoutInSec",value:function(e){d.setConfig({timeoutInSec:e})}}]),e}();if(T.addFileReader(d).addFileReader(u).addFileReader(g).addTagReader(y).addTagReader(f).addTagReader(p).addTagReader(m),"undefined"!=typeof process&&!process.browser)if("undefined"!=typeof navigator&&"ReactNative"===navigator.product){var S=e("./ReactNativeFileReader");T.addFileReader(S)}else{var b=e("./NodeFileReader");T.addFileReader(b)}t.exports={read:function(e,t){new R(e).read(t)},Reader:R,Config:T}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./ReactNativeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)});

